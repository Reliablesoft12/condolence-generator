<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Condolence Letter — A4 Editor</title>

  <!-- Calibri-compatible font -->
  <link href="https://fonts.googleapis.com/css2?family=Carlito:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --a4-w:210mm;
      --a4-h:297mm;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Carlito', Calibri, sans-serif;
      background:#f4f7fb;
      padding:16px;
      color:#102135;
    }

    .app{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:360px 1fr;gap:16px}
    .panel{background:#fff;padding:12px;border-radius:10px;box-shadow:0 8px 24px rgba(10,20,40,0.06)}
    h2{margin:0 0 8px 0;font-size:17px}
    label{display:block;margin-top:10px;color:#44556b;font-size:13px}
    input[type="number"], input[type="text"], select, textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #dceaf6;font-family:'Carlito', Calibri, sans-serif}
    textarea{min-height:100px;resize:vertical}

    .row{display:flex;gap:8px;align-items:center;margin-top:8px}
    .row input[type="range"]{flex:1}
    .btn{margin-top:12px;padding:10px 12px;border-radius:8px;border:0;background:linear-gradient(90deg,#0b75d6,#06b6d4);color:#fff;font-weight:700;cursor:pointer}

    /* preview area */
    .preview-wrap{padding:12px}
    .preview-toolbar{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:8px}
    .preview-viewport{background:#eaf4ff;padding:12px;border-radius:8px;border:1px solid #d6e9fb;overflow:auto}

    /* scaled preview container */
    .preview-stage{display:flex;justify-content:center;padding:18px}
    .page-outer{background:#fff;border:1px solid #dbeaf8;border-radius:6px;box-shadow:0 10px 28px rgba(9,30,63,0.04);overflow:hidden}
    .page {
      width: var(--a4-w);
      height: var(--a4-h);
      background: white;
      box-sizing: border-box;
      position: relative;
      transform-origin: top left;
      /* default padding will be set inline by JS (mm values) */
    }

    /* guideline lines */
    .guide-top, .guide-bottom { position:absolute; left:0; right:0; height:1px; background:rgba(11,55,100,0.16); pointer-events:none; }
    .guide-left, .guide-right { position:absolute; top:0; bottom:0; width:1px; background:rgba(11,55,100,0.16); pointer-events:none; }

    /* letter content styling (uses Calibri-like font) */
    .letter { font-family:'Carlito', Calibri, sans-serif; color:#000; }
    .letter .meta { text-align:right; margin-bottom:12mm }
    .letter .to { margin-bottom:14mm }
    .letter .to .recipient { font-weight:700 }
    .letter .body-paragraph { margin:10mm 0; text-align:justify }
    .letter .signatures { display:flex; justify-content:space-between; margin-top:24mm }
    .letter .sig-title { font-weight:400; font-size:11pt }

    .note{font-size:13px;color:#4b657a;margin-top:10px}
    @media(max-width:980px){ .app{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="app">
    <!-- Controls -->
    <div class="panel">
      <h2>Page / Margin Controls</h2>

      <label>Top margin (mm)</label>
      <div class="row"><input id="topRange" type="range" min="0" max="80" step="0.1" value="25.4"><input id="topNum" type="number" min="0" max="80" step="0.1" value="25.4"></div>

      <label>Right margin (mm)</label>
      <div class="row"><input id="rightRange" type="range" min="0" max="80" step="0.1" value="25.4"><input id="rightNum" type="number" min="0" max="80" step="0.1" value="25.4"></div>

      <label>Bottom margin (mm)</label>
      <div class="row"><input id="bottomRange" type="range" min="0" max="80" step="0.1" value="25.4"><input id="bottomNum" type="number" min="0" max="80" step="0.1" value="25.4"></div>

      <label>Left margin (mm)</label>
      <div class="row"><input id="leftRange" type="range" min="0" max="80" step="0.1" value="25.4"><input id="leftNum" type="number" min="0" max="80" step="0.1" value="25.4"></div>

      <hr style="margin:12px 0;border:none;border-top:1px solid #eef6ff">

      <h2>Editor & Typography</h2>
      <label>Font size (pt)</label>
      <div class="row"><input id="fontRange" type="range" min="8" max="18" step="0.5" value="12"><input id="fontNum" type="number" min="8" max="18" step="0.5" value="12"></div>

      <label>Preview scale (%)</label>
      <div class="row"><input id="scaleRange" type="range" min="20" max="100" step="1" value="45"><input id="scaleNum" type="number" min="20" max="100" step="1" value="45"></div>

      <label>Recipient / Member name</label>
      <input id="member" type="text" placeholder="Rtn. Rajneesh Parek">

      <label>Relation</label>
      <input id="relation" type="text" placeholder="mother">

      <label>Deceased person name</label>
      <input id="deceased" type="text" placeholder="Madhubala Pareek">

      <label>Gender</label>
      <select id="gender"><option value="female">Female (she/her)</option><option value="male">Male (he/his)</option><option value="other">Other (they/their)</option></select>

      <label style="margin-top:10px">Letter body (editable) — paste exact matter below</label>
      <textarea id="bodyText">We extend our deepest condolences on the passing of your <Relation> <Deceased> for the untimely loss of <her> life. Losing a family member is always difficult to face.

In this tough period of your life's journey, we are committed to being there for you. In light of the loss of your <Relation>, we are sympathetic to your efforts to move forward with your life's work.

<She> will always be remembered with great admiration. May God give strength to you & your family during this difficult time.</textarea>

      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="generateBtn" class="btn">Generate & Download PDF</button>
        <button id="resetBtn" class="btn" style="background:#e6eef8;color:#0b75d6">Reset to defaults</button>
      </div>

      <div class="note">Use the preview scale to zoom the page. When satisfied, click Generate. Print PDF at 100% Actual size.</div>
    </div>

    <!-- Preview -->
    <div class="panel preview-wrap">
      <div class="preview-toolbar">
        <div><strong>Live A4 preview</strong></div>
        <div style="color:#4b667a">Scaled preview — adjust scale to avoid cropping</div>
      </div>

      <div class="preview-viewport">
        <div class="preview-stage">
          <div class="page-outer" id="pageOuter">
            <div class="page letter" id="page">
              <!-- overlay guides -->
              <div class="guide-top" id="guideTop"></div>
              <div class="guide-bottom" id="guideBottom"></div>
              <div class="guide-left" id="guideLeft"></div>
              <div class="guide-right" id="guideRight"></div>

              <!-- content -->
              <div class="meta" id="metaDate">10 September 2025</div>
              <div class="to">To,<br>Rtn. <span id="previewMember" class="recipient">—</span>,</div>
              <div id="contentHtml">
                <!-- inserted by JS -->
              </div>

              <div class="signatures" id="signs">
                <div>
                  Warm Regards,<br><br>
                  Rtn. Rajesh Kumar Narula<br>
                  <div class="sig-title">(President)</div>
                </div>
                <div style="text-align:right">
                  Rtn. Dr. D.S. Rathore<br>
                  <div class="sig-title">(Secretary)</div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- html2pdf -->
  <script src="https://unpkg.com/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

  <script>
    // DOM refs
    const topRange = document.getElementById('topRange'), topNum = document.getElementById('topNum');
    const rightRange = document.getElementById('rightRange'), rightNum = document.getElementById('rightNum');
    const bottomRange = document.getElementById('bottomRange'), bottomNum = document.getElementById('bottomNum');
    const leftRange = document.getElementById('leftRange'), leftNum = document.getElementById('leftNum');

    const fontRange = document.getElementById('fontRange'), fontNum = document.getElementById('fontNum');
    const scaleRange = document.getElementById('scaleRange'), scaleNum = document.getElementById('scaleNum');

    const member = document.getElementById('member'), relation = document.getElementById('relation'), deceased = document.getElementById('deceased'), gender = document.getElementById('gender');
    const bodyText = document.getElementById('bodyText');

    const page = document.getElementById('page'), pageOuter = document.getElementById('pageOuter');
    const guideTop = document.getElementById('guideTop'), guideBottom = document.getElementById('guideBottom'), guideLeft = document.getElementById('guideLeft'), guideRight = document.getElementById('guideRight');
    const contentHtml = document.getElementById('contentHtml');
    const previewMember = document.getElementById('previewMember');

    const generateBtn = document.getElementById('generateBtn'), resetBtn = document.getElementById('resetBtn');

    // Sync paired inputs
    function bindRangeNumber(range, number){
      range.addEventListener('input', ()=>{ number.value = range.value; updateFromControls(); });
      number.addEventListener('input', ()=>{ range.value = number.value; updateFromControls(); });
    }
    bindRangeNumber(topRange, topNum);
    bindRangeNumber(rightRange, rightNum);
    bindRangeNumber(bottomRange, bottomNum);
    bindRangeNumber(leftRange, leftNum);
    bindRangeNumber(fontRange, fontNum);
    bindRangeNumber(scaleRange, scaleNum);

    // init defaults
    function resetDefaults(){
      topRange.value = topNum.value = 25.4;
      rightRange.value = rightNum.value = 25.4;
      bottomRange.value = bottomNum.value = 25.4;
      leftRange.value = leftNum.value = 25.4;
      fontRange.value = fontNum.value = 12;
      scaleRange.value = scaleNum.value = 45;
      member.value = 'Rajneesh Parek';
      relation.value = 'mother';
      deceased.value = 'Madhubala Pareek';
      gender.value = 'female';
      bodyText.value = `We extend our deepest condolences on the passing of your <Relation> <Deceased> for the untimely loss of <her> life. Losing a family member is always difficult to face.

In this tough period of your life's journey, we are committed to being there for you. In light of the loss of your <Relation>, we are sympathetic to your efforts to move forward with your life's work.

<She> will always be remembered with great admiration. May God give strength to you & your family during this difficult time.`;
      updateFromControls();
    }
    resetDefaults();

    // update preview content and styles
    function updateFromControls(){
      // margins (mm)
      const t = parseFloat(topNum.value), r = parseFloat(rightNum.value), b = parseFloat(bottomNum.value), l = parseFloat(leftNum.value);
      // scale percent
      const scalePercent = parseFloat(scaleNum.value);
      const scale = scalePercent / 100;

      // apply padding to real page (for preview we scale by transform)
      // page is full-size A4; using transform to scale to fit; to produce visual padding we set inline styles scaled.
      page.style.paddingTop = t + 'mm';
      page.style.paddingRight = r + 'mm';
      page.style.paddingBottom = b + 'mm';
      page.style.paddingLeft = l + 'mm';

      // set transform scale on outer wrapper so the page is scaled and not clipped
      page.style.transform = `scale(${scale})`;
      // adjust outer wrapper size to accomodate scaled page and center
      const pageOuterWidth = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--a4-w') || 210) * (scale/1); // not used directly; page's transform handles sizing

      // set font size inside letter
      const fontPt = parseFloat(fontNum.value) || 12;
      page.style.fontSize = fontPt + 'pt';

      // compute guide positions (they are absolute inside page, unscaled)
      // top guide at paddingTop
      guideTop.style.top = (t) + 'mm';
      guideLeft.style.left = (l) + 'mm';
      // bottom guide placed from top = page height - bottom padding
      guideBottom.style.top = `calc(100% - ${b}mm)`;
      guideRight.style.left = `calc(100% - ${r}mm)`;

      // update textual content by replacing placeholders in bodyText
      let text = bodyText.value;
      // placeholders: <Relation>, <Deceased>, <her>/<his>/<their>, <She>/<He>/<They>
      const rel = relation.value.trim() || '—';
      const dec = deceased.value.trim() || '—';
      const g = gender.value;
      let objPron='her', subjPron='She';
      if (g === 'male'){ objPron='his'; subjPron='He'; }
      else if (g === 'other'){ objPron='their'; subjPron='They'; }

      text = text.replace(/<Relation>/g, rel).replace(/<Deceased>/g, dec).replace(/<her>/g, objPron).replace(/<She>/g, subjPron);

      // Convert text paragraphs to HTML paragraphs; preserve blank lines
      const paragraphs = text.split(/\n\s*\n/).map(p => `<div class="body-paragraph">${escapeHtml(p).replace(/\n/g,'<br>')}</div>`).join('\n');
      contentHtml.innerHTML = paragraphs;

      // update recipient display
      previewMember.textContent = member.value.trim() || '—';
    }

    // escape helper
    function escapeHtml(str){ return String(str).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]) }); }

    // update when fields change
    [topRange,rightRange,bottomRange,leftRange,topNum,rightNum,bottomNum,leftNum,fontRange,fontNum,scaleRange,scaleNum,member,relation,deceased,gender,bodyText].forEach(el=>{
      el.addEventListener('input', updateFromControls);
      el.addEventListener('change', updateFromControls);
    });

    // reset
    resetBtn.addEventListener('click', (e)=>{ e.preventDefault(); resetDefaults(); });

    // generate PDF: build printable element at full A4 size with exact margins & font size
    generateBtn.addEventListener('click', async ()=>{
      updateFromControls();
      const t = parseFloat(topNum.value), r = parseFloat(rightNum.value), b = parseFloat(bottomNum.value), l = parseFloat(leftNum.value);
      const fontPt = parseFloat(fontNum.value) || 12;
      const memberText = member.value.trim() || '—';
      const rel = relation.value.trim() || '—';
      const dec = deceased.value.trim() || '—';
      const g = gender.value;
      let objPron='her', subjPron='She';
      if (g==='male'){ objPron='his'; subjPron='He'; } else if (g==='other'){ objPron='their'; subjPron='They'; }

      // build printable container
      const printable = document.createElement('div');
      printable.style.width = '210mm';
      printable.style.minHeight = '297mm';
      printable.style.boxSizing = 'border-box';
      printable.style.padding = `${t}mm ${r}mm ${b}mm ${l}mm`;
      printable.style.fontFamily = `'Carlito', Calibri, sans-serif`;
      printable.style.fontSize = fontPt + 'pt';
      printable.style.lineHeight = '1.5';
      printable.style.background = '#fff';
      printable.style.color = '#000';

      // compute date
      const dateText = (new Date()).toLocaleDateString(undefined,{day:'2-digit',month:'long',year:'numeric'});

      // prepare body with placeholders replaced
      let body = bodyText.value;
      body = body.replace(/<Relation>/g, rel).replace(/<Deceased>/g, dec).replace(/<her>/g, objPron).replace(/<She>/g, subjPron);
      // paragraphs -> <div>
      const paras = body.split(/\n\s*\n/).map(p=>`<div style="margin:8mm 0;text-align:justify">${escapeHtml(p).replace(/\n/g,'<br>')}</div>`).join('');

      printable.innerHTML = `
        <div style="text-align:right;margin-bottom:12mm">${escapeHtml(dateText)}</div>
        <div style="margin-bottom:14mm">To,<br>Rtn. ${escapeHtml(memberText)},</div>
        ${paras}
        <div style="display:flex;justify-content:space-between;margin-top:20mm">
          <div>
            Warm Regards,<br><br>
            Rtn. Rajesh Kumar Narula<br>
            <div style="font-weight:400">(President)</div>
          </div>
          <div style="text-align:right">
            Rtn. Dr. D.S. Rathore<br>
            <div style="font-weight:400">(Secretary)</div>
          </div>
        </div>
      `;

      // attach hidden to body to allow images/fonts to load (we have no external images)
      printable.style.position = 'fixed';
      printable.style.left = '-9999px';
      printable.style.top = '-9999px';
      document.body.appendChild(printable);

      const opt = {
        margin: [t, r, b, l], // mm units
        filename: `condolence_${(dec||'deceased').replace(/\s+/g,'_')}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };

      try {
        await html2pdf().set(opt).from(printable).save();
      } finally {
        printable.remove();
      }
    });

    // initial layout adjustments
    window.addEventListener('load', ()=>{ updateFromControls(); });
    window.addEventListener('resize', ()=>{ updateFromControls(); });

  </script>
</body>
</html>
